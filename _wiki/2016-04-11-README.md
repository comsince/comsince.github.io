---
layout: wiki
title: "分布式系统架构高并发高可用"
categories: [Android, Tech]
description: 个人Github博客内容说明汇总
keywords: Java,Web
---

## 关于新技术引入说明

任何一项新的技术引入必然有由某种需求驱动，因此在理解一项技术时，根据技术变迁的整体路径，分析它引入的原因，并有针对性的学习该新技术时如何驱动现有业务前行，最终形成自己的只是体系

* 理解一项技术整体解决方案
* 熟练掌握其基础特性,了解其常见的特性以及容易出现问题的地方
* 深入使用其高级特性并对比其他方案，研究其优劣
* 深入源码理解这些特性是如何实现的
* 吸收其设计思想与方法
* 积累特定领域问题的解决方案（例如秒杀场景）


技术的分类，大致分为如下两类
## 开发框架

为开发提供技术与方案设计，开发者如要知道该框架的实现原理，以便于更好的使用该框架提供的功能，并且在遇到问题时能够快速解决
  * Spring 家族系列框架，提供web开发脚手架，还有其他衍生的框架
    * Spring-WebMVC
    * Spring-Cloud
    * Spring-Boot
    * Spring 一系列子项目

## 基础项目
  * Netty 高性能网络库
  * Shiro 安全权限框架
  * ORM 框架 MyBatis JPA Hibernate
  * Hystrix 熔断 限流 降级
  * 任务调度框架 elastic-job
  * RPC框架 Dubbo


## 中间件项目

属于架构系列的项目，为开发提供完整的技术方案，这些产品有可能是提供一系列产品的易用性

  * 数据库中间件 sharding-jdbc
  * 分布式消息队列 Kafka RocketMq

以上框架产品需要结合自己的项目，集成其中发挥其作用

## 高性能架构产品

这类属于成熟的产品，多见于分布式系统领域，为企业提供成套的解决方案,这类产品属于某个领域的特定解决方案，为了实现在某一特定领域发展到一定程度后产生的技术革新，这类产品工程巨大，这类产品的学习
在把握其基本原理，能够熟练应用，并且能解决基本的问题，如果需要加深需要特定行业深入研究
  * 分布式文件系统 Hadoop
  * 分布式数据库 HBase
  * 分布式计算框架 Spark，Storm
  * 分布式搜索引擎 Solr，ElasticSearch

## 服务器产品

解决诸如高性能架构下问题，以及基本的数据架构
  * MySql 关系型数据库  
  * Redis 内存型数据库 twproxy 实现redis横向扩容，集群管理
  * Nginx 高性能服务器
  * Tomcat，Jetty  Web Serverlet容器

## DevOps
  * Jenkins  持续集成工具
  * Maven Gradle 自动化构建工具
  * Docker 容器部署

## 架构原理
如何利用以上产品进行最优的组合设计出最适合当前业务的系统，最终实现高可用，高性能的服务器架构，同时注重积累优秀的组合解决方案


## 分布式系统
构建分布式系统需要上面的各个组件的配合完成,分布式系统需要需要解决的核心问题及其对应的解决方案

### 分布式配置中心 
* Apollo

### 注册中心
服务注册与发现
Spring cloud Config，Eureka，Alibaba Nacos

### 分布式调用
* Dubbo
微服务划分需要实现实现服务间高效的调用，需要选用RPC中间件

* RestFul调用
Spring Fegin

### 服务负载
* Ribbon

### 服务熔断

* Hystrix

### 统一网关
* Zuul

### Spring Cloud 家族分布式核心组件
* Eureka：各个服务启动时，Eureka Client都会将服务注册到Eureka Server，并且Eureka Client还可以反过来从Eureka Server拉取注册表，从而知道其他服务在哪里
* Ribbon：服务间发起请求的时候，基于Ribbon做负载均衡，从一个服务的多台机器中选择一台
* Feign：基于Feign的动态代理机制，根据注解和选择的机器，拼接请求URL地址，发起请求
* Hystrix：发起请求是通过Hystrix的线程池来走的，不同的服务走不同的线程池，实现了不同服务调用的隔离，避免了服务雪崩的问题
* Zuul：如果前端、移动端要调用后端系统，统一从Zuul网关进入，由Zuul网关转发请求给对应的服务

**NOTE:** [拜托！面试请不要再问我Spring Cloud底层原理](https://www.toutiao.com/i6620612661602173453/)

### 快速构建微服务
* Spring-Boot
Spring-Boot，构建存java项目以及web项目，实现单独快速部署，这个是利用Spring家族快速集成rpc，配置中心等框架实现项目快速开发部署

### 分布式事务
引入微服务后，出现的数据一致性问题如何解决?
多个服务间调用如何保证数据的一致性

#### CAP理论
#### 数据一致性-分布式事务
  * [常用分布式事务解决方案](https://juejin.im/post/5aa3c7736fb9a028bb189bca)
  * 全局消息
  * 基于可靠消息服务的分布式事务
  * TCC
  * 最大努力通知

### 高并发
利用多级缓存实现系统高并发，本地缓存，redis缓存，数据库读写分离，分布分表，利用sharding-jdbc

### 高可用
服务熔断，降级，利用Hystrix实现服务限流，降级，监控  


* [源码解析博客](http://www.iocoder.cn/Architecture/books-recommended/)

### Spring Cloud
* [Spring Cloud 系列文章](http://www.ityouknow.com/)


## 高并发高可用架构

### 1、亿级流量电商网站的商品详情页系统架构

面临难题：对于每天上亿流量，拥有上亿页面的大型电商网站来说，能够支撑高并发访问，同时能够秒级让最新模板生效的商品详情页系统的架构是如何设计的？

解决方案：异步多级缓存架构+nginx本地化缓存+动态模板渲染的架构

### 2、redis企业级集群架构

面临难题：如何让redis集群支撑几十万QPS高并发+99.99%高可用+TB级海量数据+企业级数据备份与恢复？

解决方案：redis的企业级备份恢复方案+复制架构+读写分离+哨兵架构+redis cluster集群部署

技术要点：redis集群规划与部署

### 3、多级缓存架构设计

面临难题：如何将缓存架构设计的能够支撑高性能以及高并发到极致？同时还要给缓存架构最后的一个安全保护层？

解决方案：nginx抗热点数据+redis抗大规模离线请求+ehcache抗redis崩溃的三级缓存架构

### 4、数据库+缓存双写一致性解决方案

面临难题：高并发场景下，如何解决数据库与缓存双写的时候数据不一致的情况？

解决方案：异步队列串行化的数据库+缓存双写一致性解决方案

### 5、缓存维度化拆分解决方案

面临难题：如何解决大value缓存的全量更新效率低下问题？

解决方案：商品缓存数据的维度化拆分解决方案

### 6、缓存命中率提升解决方案

面临难题：如何将缓存命中率提升到极致？

解决方案：双层nginx部署架构+lua脚本实现一致性hash流量分发策略

### 7、缓存并发重建冲突解决方案

面临难题：如何解决高并发场景下，缓存重建时的分布式并发重建的冲突问题？

解决方案：基于zookeeper分布式锁的缓存并发重建冲突解决方案

技术要点：zookeeper 临时与持久节点

### 8、缓存预热解决方案

面临难题：如何解决高并发场景下，缓存冷启动导致MySQL负载过高，甚至瞬间被打死的问题？

解决方案：基于storm实时统计热数据的分布式快速缓存预热解决方案

### 9、热点缓存自动降级方案

面临难题：如何解决热点缓存导致单机器负载瞬间超高？

解决方案：基于storm的实时热点发现+毫秒级的实时热点缓存负载均衡降级

### 10、高可用分布式系统架构设计

面临难题：如何解决分布式系统中的服务高可用问题？避免多层服务依赖因为少量故障导致系统崩溃？

解决方案：基于hystrix的高可用缓存服务，资源隔离+限流+降级+熔断+超时控制

### 11、复杂的高可用分布式系统架构设计

面临难题：如何针对复杂的分布式系统将其中的服务设计为高可用架构？

解决方案：基于hystrix的容错+多级降级+手动降级+生产环境参数优化经验+可视化运维与监控

技术要点：Hystrix 

### 12、缓存雪崩解决方案

面临难题：如何解决恐怖的缓存雪崩问题？避免给公司带来巨大的经济损失？

解决方案：全网独家的事前+事中+事后三层次完美缓存雪崩解决方案

### 13、缓存穿透解决方案

面临难题：如何解决高并发场景下的缓存穿透问题？避免给MySQL带来过大的压力？

解决方案：缓存穿透解决方案，即使没有获取到数据也要进行空数据标记

### 14、缓存失效解决方案

面临难题：如何解决高并发场景下的缓存失效问题？避免给redis集群带来过大的压力？

解决方案：基于随机过期时间的缓存失效解决方案